# SAX v3.11.0 - Orchestrator-First Policy 적용 및 CLAUDE.md 구조 개선

**Release Date**: 2025-11-26

## Overview

모든 SAX 패키지에 Orchestrator-First Policy를 명시하고, CLAUDE.md에서 Agent 목록을 제거하여 Orchestrator 중심 구조로 개편했습니다. 또한 `.claude/CLAUDE.md`에 패키지 선택 시 시스템 메시지 출력 규칙을 추가했습니다.

## Changes

### .claude/CLAUDE.md (docs 레포 진입점)

#### Added

- **시스템 메시지 출력 규칙**: 패키지 선택 시 사용자에게 어떤 패키지가 활성화되었는지 명확히 알림
  - SAX-Meta 선택 시: `[SAX] System: SAX-Meta 패키지 활성화`
  - SAX-PO 선택 시: `[SAX] System: SAX-PO 패키지 활성화`
  - > ⚠️ **중요**: 이 메시지는 **반드시 출력**해야 합니다.

- **Orchestrator 라우팅 명시**: 컨텍스트 전환 시 Orchestrator가 모든 요청을 라우팅한다는 것을 명시

### SAX-Meta

#### Changed

- **Agent 목록 제거**: `## Package Components` 섹션에서 Agent 목록 삭제
- **Orchestrator-First Policy 추가**:
  - 모든 요청이 Orchestrator를 먼저 통과한다는 규칙 명시
  - 라우팅 흐름 다이어그램 추가
  - 주요 라우팅 테이블 추가 (Agent 생성, Skill 생성, Command 생성, 패키지 검증, 버전 관리, 패키지 설계)
  - Orchestrator Agent 참조 링크 추가

#### Rationale

- **CLAUDE.md의 역할 변경**: Agent 목록을 나열하는 것이 아니라, Orchestrator가 모든 요청을 처리한다는 규칙을 명시
- **유지보수성 향상**: Agent 추가/삭제 시 CLAUDE.md를 수정할 필요 없음 (Orchestrator만 수정)
- **명확한 워크플로우**: 사용자 → Orchestrator → Agent/Skill 흐름을 명확히 전달

### SAX-PO

#### Changed

- **Agent 목록 제거**: `## Package Components` 섹션에서 Agent 목록 삭제
- **Orchestrator-First Policy 추가**:
  - 모든 요청이 Orchestrator를 먼저 통과한다는 규칙 명시
  - 라우팅 흐름 다이어그램 추가 (텍스트 기반)
  - 주요 라우팅 테이블 추가 (Epic 생성, Epic 이식, Draft Task, Spec 초안, 온보딩, 학습 요청, 환경 검증)
  - Orchestrator Agent 참조 링크 추가

#### Rationale

- SAX-Meta와 동일한 이유로 Orchestrator 중심 구조로 통일

## Impact

### SAX 개발자

- **CLAUDE.md 유지보수 감소**: Agent 추가/삭제 시 CLAUDE.md 수정 불필요
- **명확한 라우팅 규칙**: Orchestrator가 모든 요청을 처리한다는 것을 명시
- **일관된 구조**: 모든 SAX 패키지가 동일한 Orchestrator-First Policy 적용

### SAX 사용자 (PO/개발자)

- **패키지 선택 가시성**: 어떤 패키지로 동작하는지 시스템 메시지로 명확히 확인
- **요청 흐름 이해**: Orchestrator → Agent/Skill 흐름을 통해 어떻게 작동하는지 이해 가능

## Migration Guide

### 기존 CLAUDE.md Agent 목록 참조

**Before** (v3.10.0):
```markdown
## Package Components

### Agents

| Agent | 역할 | 파일 |
|-------|------|------|
| orchestrator | ... | ... |
| epic-master | ... | ... |
```

**After** (v3.11.0):
```markdown
## Orchestrator-First Policy

모든 요청은 Orchestrator를 먼저 통과합니다.

### 주요 라우팅

| 요청 유형 | 위임 대상 | 키워드 |
|----------|-----------|--------|
| Epic 생성 | epic-master | "Epic 만들어" |
```

### Agent 추가/삭제 시

**Before**: CLAUDE.md Agent 목록 수정 필요

**After**: Orchestrator Routing Table만 수정

## Technical Details

### 패키지 선택 시스템 메시지

`.claude/CLAUDE.md`의 "구현 로직" 섹션 3번 항목:

```markdown
3. **시스템 메시지 출력** (필수):
   [SAX] System: {선택된 패키지} 패키지 활성화

   > ⚠️ 이 메시지는 **반드시 출력**해야 합니다.
```

### Orchestrator-First Policy 구조

**라우팅 흐름**:
```text
사용자 요청
    ↓
[Orchestrator] 의도 분석
    ↓
[Agent 위임] 또는 [Skill 실행]
    ↓
작업 수행
```

**주요 라우팅 테이블**:
- SAX-Meta: Agent/Skill 생성, 패키지 관리 중심
- SAX-PO: Epic/Task 생성, 기획 워크플로우 중심

## Breaking Changes

없음. 기존 동작 방식은 동일하며, CLAUDE.md 구조만 개선되었습니다.

## Future Improvements

### 앞으로의 CLAUDE.md 관리 방향

1. **Agent 정보는 CLAUDE.md에 포함하지 않음**: Orchestrator Routing Table만 유지
2. **Skill 목록은 유지**: Skill은 직접 실행 가능하므로 참조용으로 목록 유지
3. **Command 목록은 유지**: 슬래시 커맨드는 사용자가 직접 입력하므로 참조용으로 목록 유지
4. **템플릿 목록은 유지**: 파일 경로 참조가 필요하므로 유지

### 일관성 유지

- 모든 새로운 SAX 패키지 (SAX-Next, SAX-Spring 등)도 동일한 Orchestrator-First Policy 구조 적용
- Agent 추가 시 Orchestrator Routing Table만 업데이트

## References

- [SAX Core Principles](https://github.com/semicolon-devteam/docs/blob/main/sax/core/PRINCIPLES.md)
- [SAX Core Message Rules](https://github.com/semicolon-devteam/docs/blob/main/sax/core/MESSAGE_RULES.md)
- [.claude/CLAUDE.md](https://github.com/semicolon-devteam/docs/blob/main/.claude/CLAUDE.md)
- [SAX-Meta Orchestrator](https://github.com/semicolon-devteam/docs/blob/main/sax/packages/sax-meta/agents/orchestrator.md)
- [SAX-PO Orchestrator](https://github.com/semicolon-devteam/docs/blob/main/sax/packages/sax-po/agents/orchestrator.md)

## Contributors

- SAX Development Team
